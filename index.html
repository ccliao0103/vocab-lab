<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VocabLab | ç†å·¥å­¸ç§‘è‹±èª</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --error-color: #e74c3c;
            --bg-color: #f4f6f7;
            --card-bg: #ffffff;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        header { text-align: center; margin-bottom: 20px; }
        h1 { color: var(--primary-color); margin-bottom: 5px; }
        p { color: #666; font-size: 0.9rem; }

        /* --- æ¨¡å¼åˆ‡æ›æ¨™ç±¤ --- */
        .mode-tabs {
            display: flex;
            background: #e0e0e0;
            border-radius: 50px;
            padding: 5px;
            margin-bottom: 25px;
        }
        .mode-tab {
            padding: 10px 25px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            color: #666;
            background: transparent;
            transition: 0.3s;
        }
        .mode-tab.active {
            background-color: white;
            color: var(--primary-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* --- é€šç”¨éš±è—å·¥å…· --- */
        .hidden { display: none !important; }

        /* --- å–®å­—å¡æ¨¡å¼æ¨£å¼ (ä¿ç•™åŸæœ¬è¨­è¨ˆ) --- */
        .controls {
            margin-bottom: 25px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }
        button.filter-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 50px;
            cursor: pointer;
            opacity: 0.8;
            transition: 0.2s;
        }
        button.filter-btn:hover { opacity: 1; transform: translateY(-2px); }
        button.filter-btn.active { 
            background-color: var(--accent-color); opacity: 1; 
        }

        .card-container { width: 100%; max-width: 500px; margin-bottom: 20px; }
        .card {
            background-color: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
            border: 1px solid #eee;
        }
        .card:active { transform: scale(0.98); }
        
        .term-row { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .term { font-size: 2.5rem; font-weight: 800; color: var(--primary-color); line-height: 1.2; }
        .audio-btn {
            background: #eef2f7; border: none; border-radius: 50%; width: 40px; height: 40px;
            cursor: pointer; font-size: 1.2rem; transition: 0.2s; color: var(--primary-color);
        }
        .audio-btn:hover { background: var(--accent-color); color: white; transform: scale(1.1); }
        
        .category-tag { display: inline-block; background: #eef2f7; color: #7f8c8d; padding: 5px 12px; border-radius: 15px; font-size: 0.85rem; font-weight: 600; }
        .tap-hint { margin-top: 20px; color: #bdc3c7; font-size: 0.8rem; animation: fadeIn 1s infinite alternate; }
        .answer-section { display: none; margin-top: 30px; padding-top: 20px; border-top: 2px dashed #eee; animation: slideDown 0.3s ease-out; }
        
        .translation { font-size: 1.8rem; font-weight: bold; color: var(--accent-color); margin-bottom: 10px; }
        .definition { font-size: 1rem; color: #555; margin-bottom: 15px; text-align: left; background: #f9f9f9; padding: 15px; border-radius: 10px; }
        .example { font-style: italic; font-size: 0.9rem; color: #888; text-align: left; border-left: 3px solid var(--accent-color); padding-left: 10px; }

        .big-btn {
            background-color: var(--accent-color); color: white; border: none; border-radius: 50px;
            padding: 12px 50px; font-size: 1.2rem; font-weight: bold; cursor: pointer; margin-top: 10px;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.4);
        }
        .big-btn:hover { transform: translateY(-2px); }

        /* --- æ¸¬é©—æ¨¡å¼æ¨£å¼ (æ–°å¢) --- */
        #quiz-view { width: 100%; max-width: 500px; display: flex; flex-direction: column; align-items: center; }
        
        .quiz-status { width: 100%; display: flex; justify-content: space-between; margin-bottom: 15px; color: #666; font-weight: bold; }
        
        .quiz-card {
            width: 100%; background: white; padding: 30px; border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center;
        }
        
        .quiz-question { font-size: 2rem; font-weight: 800; color: var(--primary-color); margin-bottom: 25px; }
        
        .options-grid { display: grid; grid-template-columns: 1fr; gap: 10px; width: 100%; }
        
        .option-btn {
            background: #f8f9fa; border: 2px solid #e9ecef; padding: 15px; border-radius: 10px;
            font-size: 1.1rem; cursor: pointer; transition: 0.2s; color: #495057; font-weight: 500;
        }
        .option-btn:hover:not(.disabled) { background: #e3f2fd; border-color: var(--accent-color); }
        
        /* ä½œç­”å¾Œçš„å›é¥‹æ¨£å¼ */
        .option-btn.correct { background: var(--success-color); color: white; border-color: var(--success-color); }
        .option-btn.wrong { background: var(--error-color); color: white; border-color: var(--error-color); opacity: 0.6; }
        .option-btn.disabled { cursor: default; pointer-events: none; }

        .quiz-feedback { margin-top: 20px; font-size: 1.1rem; font-weight: bold; min-height: 24px; }
        .quiz-next-btn { margin-top: 20px; background: var(--primary-color); }

        /* --- æ¸¬é©—çµæœé  --- */
        .result-card { text-align: center; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 400px;}
        .score-circle { 
            width: 120px; height: 120px; background: var(--accent-color); color: white; 
            border-radius: 50%; display: flex; justify-content: center; align-items: center; 
            font-size: 2.5rem; font-weight: bold; margin: 0 auto 20px auto; 
        }

        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0.4; } to { opacity: 1; } }
    </style>
</head>
<body>

    <header>
        <h1>VocabLab ç†å·¥å­¸ç§‘è‹±èª</h1>
        <p>Lab for Science & Engineering Vocabulary</p>
    </header>

    <div class="mode-tabs">
        <button class="mode-tab active" onclick="switchMode('flashcard')">å–®å­—å¡ Flashcards</button>
        <button class="mode-tab" onclick="switchMode('quiz')">æ¸¬é©— Quiz</button>
    </div>

    <div id="flashcard-view">
        <div class="controls">
            <button class="filter-btn active" data-filter="all">å…¨éƒ¨ (All)</button>
            <button class="filter-btn" data-filter="Chemistry">åŒ–å­¸</button>
            <button class="filter-btn" data-filter="Chemical Engineering">åŒ–å·¥</button>
            <button class="filter-btn" data-filter="Materials Science">ææ–™</button>
        </div>

        <div class="card-container">
            <div class="card" onclick="toggleAnswer()">
                <div class="term-section">
                    <div class="term-row">
                        <div class="term" id="term-text">Loading...</div>
                        <button class="audio-btn" onclick="playAudio(event, 'term-text')" title="ç™¼éŸ³">ğŸ”Š</button>
                    </div>
                    <div class="category-tag" id="category-text">Subject</div>
                </div>
                <div class="tap-hint" id="hint-text">ğŸ‘† é»æ“Šé¡¯ç¤ºä¸­æ–‡ (Reveal)</div>
                <div class="answer-section" id="answer-box">
                    <div class="translation" id="trans-text">ä¸­æ–‡ç¿»è­¯</div>
                    <div class="definition" id="def-text">è‹±æ–‡å®šç¾©...</div>
                    <div class="example" id="ex-text">ä¾‹å¥...</div>
                </div>
            </div>
        </div>
        <button class="big-btn" onclick="nextCard()">Next Word ä¸‹ä¸€å€‹</button>
    </div>

    <div id="quiz-view" class="hidden">
        
        <div id="quiz-playing" style="width: 100%;">
            <div class="quiz-status">
                <span id="quiz-progress">Question: 1/10</span>
                <span id="quiz-score">Score: 0</span>
            </div>
            
            <div class="quiz-card">
                <div style="margin-bottom:10px; font-size:0.9rem; color:#999;" id="quiz-category">Category</div>
                <div class="quiz-question" id="quiz-question-text">Question</div>
                
                <div class="options-grid" id="options-container">
                    </div>

                <div class="quiz-feedback" id="quiz-feedback"></div>
                
                <button class="big-btn quiz-next-btn hidden" id="quiz-next-btn" onclick="nextQuizQuestion()">Next Question</button>
            </div>
        </div>

        <div id="quiz-result" class="hidden result-card">
            <h2>æ¸¬é©—çµæŸ!</h2>
            <div class="score-circle" id="final-score">80</div>
            <p id="result-comment">ä¸éŒ¯å–”ï¼</p>
            <button class="big-btn" onclick="startQuiz()">å†æ¸¬ä¸€æ¬¡ (Restart)</button>
        </div>

    </div>

    <script>
        // === å…¨åŸŸè®Šæ•¸ ===
        let allData = [];
        let currentFlashcardData = [];
        let isAnswerShown = false;

        // æ¸¬é©—è®Šæ•¸
        let quizQuestions = []; // å­˜10é¡Œé¡Œç›®
        let currentQuizIndex = 0;
        let score = 0;
        const QUIZ_LENGTH = 10;

        // === åˆå§‹åŒ–è³‡æ–™ ===
        async function fetchData() {
            try {
                const response = await fetch('data.json?' + new Date().getTime());
                allData = await response.json();
                
                // åˆå§‹åŒ–å–®å­—å¡
                currentFlashcardData = allData;
                nextCard();
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('term-text').innerText = "è³‡æ–™è®€å–å¤±æ•—";
            }
        }

        // ==========================================
        //  åŠŸèƒ½ 1: æ¨¡å¼åˆ‡æ›é‚è¼¯
        // ==========================================
        function switchMode(mode) {
            // åˆ‡æ›æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.mode-tab').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (mode === 'flashcard') {
                document.getElementById('flashcard-view').classList.remove('hidden');
                document.getElementById('quiz-view').classList.add('hidden');
            } else {
                document.getElementById('flashcard-view').classList.add('hidden');
                document.getElementById('quiz-view').classList.remove('hidden');
                startQuiz(); // åˆ‡æ›åˆ°æ¸¬é©—æ¨¡å¼æ™‚è‡ªå‹•é–‹å§‹
            }
        }

        // ==========================================
        //  åŠŸèƒ½ 2: å–®å­—å¡é‚è¼¯ (Flashcard)
        // ==========================================
        function nextCard() {
            document.getElementById('answer-box').style.display = 'none';
            document.getElementById('hint-text').style.display = 'block';
            isAnswerShown = false;

            if (currentFlashcardData.length === 0) return;
            const randomIndex = Math.floor(Math.random() * currentFlashcardData.length);
            const item = currentFlashcardData[randomIndex];

            document.getElementById('term-text').innerText = item.term;
            document.getElementById('category-text').innerText = item.category;
            document.getElementById('trans-text').innerText = item.translation;
            document.getElementById('def-text').innerText = item.definition;
            document.getElementById('ex-text').innerText = `"${item.example}"`;
        }

        function toggleAnswer() {
            if (!isAnswerShown) {
                document.getElementById('answer-box').style.display = 'block';
                document.getElementById('hint-text').style.display = 'none';
                isAnswerShown = true;
            }
        }

        function playAudio(event, elementId) {
            event.stopPropagation();
            const textToSpeak = document.getElementById(elementId) ? document.getElementById(elementId).innerText : elementId;
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(textToSpeak);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                window.speechSynthesis.speak(utterance);
            } else {
                alert("ç€è¦½å™¨ä¸æ”¯æ´ç™¼éŸ³");
            }
        }

        // å–®å­—å¡ç¯©é¸
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                const filter = e.target.getAttribute('data-filter');
                currentFlashcardData = filter === 'all' ? allData : allData.filter(item => item.category === filter);
                nextCard();
            });
        });


        // ==========================================
        //  åŠŸèƒ½ 3: æ¸¬é©—é‚è¼¯ (Quiz System)
        // ==========================================
        
        // 1. é–‹å§‹æ¸¬é©— (åˆå§‹åŒ–)
        function startQuiz() {
            if (allData.length < 4) {
                alert("è³‡æ–™åº«å–®å­—å¤ªå°‘ï¼Œç„¡æ³•é€²è¡Œæ¸¬é©— (è‡³å°‘éœ€è¦4å€‹å–®å­—)");
                return;
            }

            // é‡ç½®è®Šæ•¸
            score = 0;
            currentQuizIndex = 0;
            
            // UI åˆ‡æ›
            document.getElementById('quiz-playing').classList.remove('hidden');
            document.getElementById('quiz-result').classList.add('hidden');

            // éš¨æ©ŸæŒ‘é¸ 10 é¡Œ (å¦‚æœé¡Œåº«å°‘æ–¼10é¡Œï¼Œå°±å–å…¨éƒ¨)
            const shuffledAll = [...allData].sort(() => 0.5 - Math.random());
            quizQuestions = shuffledAll.slice(0, Math.min(QUIZ_LENGTH, shuffledAll.length));

            loadQuizQuestion();
        }

        // 2. è¼‰å…¥é¡Œç›®
        function loadQuizQuestion() {
            const currentQ = quizQuestions[currentQuizIndex];
            
            // æ›´æ–°é€²åº¦æ¢
            document.getElementById('quiz-progress').innerText = `Question: ${currentQuizIndex + 1}/${quizQuestions.length}`;
            document.getElementById('quiz-score').innerText = `Score: ${score}`;
            document.getElementById('quiz-question-text').innerText = currentQ.term;
            document.getElementById('quiz-category').innerText = currentQ.category;
            
            // é‡ç½®ç‹€æ…‹
            document.getElementById('quiz-feedback').innerText = "";
            document.getElementById('quiz-feedback').style.color = "#333";
            document.getElementById('quiz-next-btn').classList.add('hidden');

            // --- ç”¢ç”Ÿé¸é … ---
            // A. æ­£ç¢ºç­”æ¡ˆ
            const correctAnswer = currentQ.translation;
            
            // B. éŒ¯èª¤é¸é … (å¾é¡Œåº«éš¨æ©Ÿæ‰¾ 3 å€‹ä¸ç­‰æ–¼æ­£ç¢ºç­”æ¡ˆçš„)
            const otherOptions = allData
                .filter(item => item.translation !== correctAnswer)
                .sort(() => 0.5 - Math.random())
                .slice(0, 3)
                .map(item => item.translation);
            
            // C. åˆä½µä¸¦æ‰“äº‚
            let options = [correctAnswer, ...otherOptions];
            options.sort(() => 0.5 - Math.random());

            // D. æ¸²æŸ“æŒ‰éˆ•
            const container = document.getElementById('options-container');
            container.innerHTML = ''; // æ¸…ç©ºèˆŠæŒ‰éˆ•

            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(btn, opt, correctAnswer);
                container.appendChild(btn);
            });
            
            // è‡ªå‹•å”¸å‡ºé¡Œç›®
            playAudio({stopPropagation:()=>{}}, currentQ.term);
        }

        // 3. æª¢æŸ¥ç­”æ¡ˆ
        function checkAnswer(btn, selected, correct) {
            // é–å®šæ‰€æœ‰æŒ‰éˆ•ï¼Œä¸èƒ½å†é»
            const allBtns = document.querySelectorAll('.option-btn');
            allBtns.forEach(b => b.classList.add('disabled'));

            const feedback = document.getElementById('quiz-feedback');

            if (selected === correct) {
                // ç­”å°
                btn.classList.add('correct');
                score += 10;
                feedback.innerText = "Correct! âœ…";
                feedback.style.color = "var(--success-color)";
            } else {
                // ç­”éŒ¯
                btn.classList.add('wrong');
                feedback.innerText = `Oops! æ­£ç¢ºç­”æ¡ˆæ˜¯: ${correct}`;
                feedback.style.color = "var(--error-color)";
                
                // æŠŠæ­£ç¢ºçš„é‚£ä¸€å€‹æ¨™ç¤ºå‡ºä¾†è®“å­¸ç”Ÿçœ‹
                allBtns.forEach(b => {
                    if (b.innerText === correct) b.classList.add('correct');
                });
            }

            // æ›´æ–°åˆ†æ•¸é¡¯ç¤º
            document.getElementById('quiz-score').innerText = `Score: ${score}`;

            // é¡¯ç¤ºä¸‹ä¸€é¡ŒæŒ‰éˆ•
            document.getElementById('quiz-next-btn').classList.remove('hidden');
        }

        // 4. ä¸‹ä¸€é¡Œ
        function nextQuizQuestion() {
            currentQuizIndex++;
            
            if (currentQuizIndex < quizQuestions.length) {
                loadQuizQuestion();
            } else {
                showResult();
            }
        }

        // 5. é¡¯ç¤ºçµæœ
        function showResult() {
            document.getElementById('quiz-playing').classList.add('hidden');
            document.getElementById('quiz-result').classList.remove('hidden');
            
            document.getElementById('final-score').innerText = score;
            
            const comment = document.getElementById('result-comment');
            if (score === 100) comment.innerText = "å¤ªç¥å•¦ï¼å…¨å°ï¼ğŸ†";
            else if (score >= 80) comment.innerText = "å¾ˆæ£’å–”ï¼ç¹¼çºŒä¿æŒï¼ğŸ’ª";
            else if (score >= 60) comment.innerText = "åŠæ ¼é‚Šç·£ï¼ŒåŠ æ²¹ï¼ğŸ“š";
            else comment.innerText = "å†å¤šç·´ç¿’å–®å­—å¡å–”ï¼ğŸ”¥";
        }

        // å•Ÿå‹•
        fetchData();
    </script>
</body>
</html>
